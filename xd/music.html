<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHADOW - YOUTUBE PLAYER</title>
<style>
  body {
    margin:0; padding:0; font-family:Arial, sans-serif; 
    background:#0a0a0a; color:#fff; overflow-x:hidden;
  }
  canvas { position: fixed; top: 0; left: 0; z-index: -1; }
  header {
    text-align:center; padding:20px;
    background:#ff0055; color:#fff;
    text-shadow:0 0 10px #ff77aa,0 0 20px #ff0055;
    animation: neonPulse 1.5s infinite alternate;
  }
  header h1{ margin:0; }

  /* Inputs */
  .input-section{text-align:center; margin:20px;}
  input, .search-btn {
    display:inline-block; margin:10px auto; padding:10px; border-radius:5px; 
    border:none; outline:none; font-size:16px;
  }
  input[type=text]{ width:300px; }
  .search-btn {
    background:#ff0055; color:#fff; font-weight:bold; cursor:pointer; transition:0.2s;
  }
  .search-btn:hover{ background:#cc0044; }

  /* Resultados */
  .videos-container {
    display:flex; flex-wrap:wrap; justify-content:center; gap:20px; margin-top:20px;
  }
  .video-card {
    background:linear-gradient(145deg,#1b1b1b,#111); 
    border-radius:15px; width:260px; text-align:center; 
    box-shadow:0 0 15px rgba(255,0,85,0.3);
    transition:transform 0.3s, box-shadow 0.3s;
    overflow:hidden;
  }
  .video-card:hover {
    transform:translateY(-5px) scale(1.03);
    box-shadow:0 0 20px rgba(255,0,85,0.7);
  }
  .video-card img{ width:100%; height:150px; object-fit:cover; border-radius:10px 10px 0 0; }
  .video-card h3{ font-size:16px; margin:5px 0; color:#ff77aa; text-shadow:0 0 5px #ff77aa; }
  .video-card p{ font-size:12px; margin:2px 0; }
  .video-card button{
    width:90%; padding:8px; margin:5px 0; border:none; 
    background:#ff0055; color:#fff; font-weight:bold; 
    border-radius:5px; cursor:pointer; text-shadow:0 0 3px #ff77aa; transition:0.2s;
  }
  .video-card button:hover{ background:#cc0044; transform:scale(1.05); }

  /* Playlist */
  .playlist{ display:flex; flex-wrap:nowrap; overflow-x:auto; padding:20px; gap:15px; }
  .song-card{
    background:#2a2a2a; min-width:250px; border-radius:15px;
    overflow:hidden; flex-shrink:0; transition:transform 0.3s;
  }
  .song-card:hover{ transform:scale(1.05); }
  .song-card img{ width:100%; height:140px; object-fit:cover; }
  .song-info{ padding:10px; }
  .song-info h3{ margin:5px 0; font-size:16px; }
  .song-info p{ margin:3px 0; font-size:12px; color:#bbb; }
  video,audio{ width:100%; margin-top:10px; outline:none; }
  .download-btn{
    display:inline-block; margin-top:10px; background:#1db954; color:#fff;
    padding:8px 15px; border-radius:50px; text-decoration:none; font-weight:bold;
  }
  .download-btn:hover{ background:#17a44c; }

  /* Historial */
  #searchHistory{
    margin:20px; text-align:center;
  }
  #searchHistory h2{ color:#ff77aa; margin-bottom:10px; }
  .history-btn{
    display:inline-block; background:#222; color:#fff; padding:6px 12px;
    margin:4px; border-radius:20px; cursor:pointer; font-size:14px;
    border:1px solid #ff0055; transition:0.2s;
  }
  .history-btn:hover{ background:#ff0055; }

  /* Player fijo */
  #audioPlayerContainer{
    position:fixed; bottom:0; left:0; width:100%; 
    background:#111; border-top:2px solid #ff0055;
    padding:10px; display:flex; align-items:center; justify-content:center;
  }
  #audioPlayer{ width:90%; }

  /* NotificaciÃ³n verde */
  #toast {
    position:fixed; bottom:80px; right:20px;
    background:#1db954; color:#fff; padding:10px 20px;
    border-radius:30px; font-weight:bold; display:none;
    box-shadow:0 0 15px rgba(0,255,0,0.6);
    animation: fadeInOut 2s ease forwards;
  }
  @keyframes fadeInOut {
    0%{opacity:0; transform:translateY(20px);}
    20%{opacity:1; transform:translateY(0);}
    80%{opacity:1;}
    100%{opacity:0; transform:translateY(20px);}
  }

  footer{
    margin-top:40px; text-align:center; font-size:14px; color:#888;
    border-top:1px solid #333; padding:10px;
  }
  @keyframes neonPulse{
    0%{text-shadow:0 0 5px #ff77aa,0 0 10px #ff0055;} 
    100%{text-shadow:0 0 20px #ff77aa,0 0 40px #ff0055;}
  }
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<header>
  <h1>ðŸŽµ YouTube Futurista + Player</h1>
</header>

<!-- Buscador -->
<section class="input-section">
  <input type="text" id="query" placeholder="Escribe tu bÃºsqueda...">
  <button class="search-btn" onclick="buscar()">Buscar</button>
</section>

<!-- Historial de bÃºsquedas -->
<div id="searchHistory">
  <h2>ðŸ”Ž Historial de BÃºsquedas</h2>
  <div id="historyList"></div>
</div>

<!-- Resultados -->
<div class="videos-container" id="videos"></div>

<!-- Playlist -->
<section class="input-section">
  <input type="text" id="ytUrl" placeholder="Pega el enlace de YouTube aquÃ­">
  <button onclick="downloadMedia()">ðŸŽ§ AÃ±adir</button>
</section>
<section class="playlist" id="playlist"></section>

<!-- Reproductor -->
<div id="audioPlayerContainer">
  <audio id="audioPlayer" controls></audio>
</div>

<!-- NotificaciÃ³n -->
<div id="toast">âœ” Link copiado</div>

<footer>
  API: <a href="https://delirius-apiofc.vercel.app" target="_blank" style="color:#ff0055;">Delirius API</a> | Dev: Black Clover & Shadow.xyz
</footer>

<script>
/* Fondo animado */
const canvas=document.getElementById('bgCanvas'),ctx=canvas.getContext('2d');
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
const particles=Array.from({length:50},()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*3+1,dx:(Math.random()-0.5)*1,dy:(Math.random()-0.5)*1}));
function animate(){ctx.clearRect(0,0,canvas.width,canvas.height);particles.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle='rgba(255,255,255,0.2)';ctx.fill();p.x+=p.dx;p.y+=p.dy;if(p.x<0||p.x>canvas.width)p.dx*=-1;if(p.y<0||p.y>canvas.height)p.dy*=-1;});requestAnimationFrame(animate);}animate();
window.addEventListener('resize',()=>{canvas.width=window.innerWidth;canvas.height=window.innerHeight;});

/* Historial con localStorage */
let searchHistory=JSON.parse(localStorage.getItem("ytHistory"))||[];
function saveHistory(){localStorage.setItem("ytHistory",JSON.stringify(searchHistory));}
function updateHistory(){
  const list=document.getElementById('historyList');
  list.innerHTML='';
  searchHistory.slice(-10).reverse().forEach(term=>{
    const btn=document.createElement('button');
    btn.className='history-btn';
    btn.textContent=term;
    btn.onclick=()=>{document.getElementById('query').value=term;buscar();};
    list.appendChild(btn);
  });
}

/* Buscar videos */
async function buscar(){
  const query=document.getElementById('query').value.trim();
  if(!query) return alert("Escribe algo para buscar");
  if(!searchHistory.includes(query)){searchHistory.push(query); saveHistory();}
  updateHistory();

  const container=document.getElementById('videos'); container.innerHTML='Cargando...';
  try{
    const res=await fetch(`https://delirius-apiofc.vercel.app/search/ytsearch?q=${encodeURIComponent(query)}`);
    const data=await res.json();
    if(!data.status || !data.data.length){ container.innerHTML='No se encontraron resultados'; return; }
    container.innerHTML='';
    data.data.slice(0,8).forEach(video=>{
      const card=document.createElement('div'); card.className='video-card';
      card.innerHTML=`
        <img src="${video.thumbnail}" alt="${video.title}">
        <h3>${video.title}</h3>
        <p><strong>Autor:</strong> <a href="${video.author.url}" target="_blank" style="color:#ff77aa;">${video.author.name}</a></p>
        <p><strong>DuraciÃ³n:</strong> ${video.duration}</p>
        <button onclick="reproducirVideo('${video.videoId}')">ðŸŽ¬ Ver Video</button>
        <button onclick="escucharAudio('${video.url}')">ðŸŽµ Escuchar Audio</button>
        <button onclick="descargarVarias('${video.url}')">â¬‡ MÃ¡s Descargas</button>
        <button onclick="copiarLink('${video.url}')">ðŸ“‹ Copiar Link</button>`;
      container.appendChild(card);
    });
  }catch(err){ container.innerHTML='Error al buscar videos'; console.error(err); }
}

/* Copiar con toast */
function copiarLink(url){
  navigator.clipboard.writeText(url).then(()=>{
    const toast=document.getElementById('toast');
    toast.style.display='block';
    setTimeout(()=>{toast.style.display='none';},2000);
  }).catch(()=>alert('Error al copiar'));
}

function reproducirVideo(videoId){window.open(`https://www.youtube.com/watch?v=${videoId}`,'_blank');}
async function escucharAudio(url){
  try{
    const res=await fetch(`https://delirius-apiofc.vercel.app/download/ytmp3?url=${encodeURIComponent(url)}`);
    const data=await res.json();
    if(data.status && data.result?.download_url){
      const audio=document.getElementById('audioPlayer');
      audio.src=data.result.download_url; audio.play();
    }else alert("No se pudo obtener el audio");
  }catch(err){console.error(err); alert("Error al reproducir audio");}
}

/* MÃ¡s descargas */
async function descargarVarias(url){
  try{
    const res=await fetch(`https://delirius-apiofc.vercel.app/download/ytmp4?url=${encodeURIComponent(url)}`);
    const data=await res.json();
    if(!data.status) return alert("No se pudo obtener info");
    let links=`
      <p><a href="${data.data.download.url}" target="_blank">ðŸŽµ MP3</a></p>
      <p><a href="${data.data.download.url}" target="_blank">ðŸ“¹ MP4 360p</a></p>
      <p><a href="${data.data.download.url}" target="_blank">ðŸ“º MP4 720p</a></p>`;
    alert("Opciones de descarga disponibles:\n\n"+links.replace(/<[^>]+>/g,''));
  }catch(err){console.error(err);}
}

/* Playlist */
const playlist=[];
async function downloadMedia(){
  const url=document.getElementById('ytUrl').value.trim();
  if(!url) return alert('Ingresa un enlace de YouTube');
  try{
    const apiUrl=`https://delirius-apiofc.vercel.app/download/ytmp3?url=${encodeURIComponent(url)}`;
    const res=await fetch(apiUrl); const data=await res.json();
    if(!data.status) return alert('Error al obtener el media');
    const song={
      title:data.data.title, author:data.data.author,
      image:data.data.image_max_resolution||data.data.image,
      duration:data.data.duration, views:data.data.views, likes:data.data.likes,
      downloadUrl:data.data.download.url, filename:data.data.download.filename,
      type:data.data.download.extension
    };
    playlist.push(song); renderPlaylist(); document.getElementById('ytUrl').value='';
  }catch(err){console.error(err); alert('Error en la descarga');}
}
function renderPlaylist(){
  const container=document.getElementById('playlist'); container.innerHTML='';
  playlist.forEach(song=>{
    const card=document.createElement('div'); card.className='song-card';
    card.innerHTML=`
      <img src="${song.image}" alt="${song.title}">
      <div class="song-info">
        <h3>${song.title}</h3>
        <p>Autor: ${song.author}</p>
        <p>DuraciÃ³n: ${Math.floor(song.duration/60)}:${('0'+(song.duration%60)).slice(-2)}</p>
        <p>Vistas: ${song.views} | Likes: ${song.likes}</p>
        ${song.type==='mp4'
          ? `<video controls src="${song.downloadUrl}"></video>`
          : `<audio controls src="${song.downloadUrl}"></audio>`}
        <a class="download-btn" href="${song.downloadUrl}" download="${song.filename}" target="_blank">ðŸ’¾ Descargar</a>
      </div>`;
    container.appendChild(card);
  });
}

/* Mostrar historial al cargar */
updateHistory();
</script>
</body>
</html>
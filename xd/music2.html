<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>shadow - YouTube MP3</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 20px;
      background: #1db954;
      color: white;
    }
    header h1 {
      margin: 0;
    }
    #inputArea {
      display: flex;
      justify-content: center;
      padding: 20px;
      gap: 10px;
    }
    #ytUrl {
      flex: 1;
      max-width: 500px;
      padding: 10px;
      border-radius: 5px;
      border: none;
    }
    button {
      padding: 10px 15px;
      background: #1db954;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: white;
      font-weight: bold;
    }
    button:hover {
      background: #14863d;
    }
    #playlist {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      padding: 20px;
    }
    .song-card {
      background: #1e1e1e;
      border-radius: 10px;
      overflow: hidden;
      transition: transform 0.2s;
      border: 2px solid transparent;
    }
    .song-card:hover {
      transform: scale(1.03);
    }
    .song-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }
    .song-info {
      padding: 15px;
    }
    .song-info h3 {
      margin: 5px 0;
      font-size: 16px;
      color: #1db954;
    }
    .song-info p {
      margin: 3px 0;
      font-size: 14px;
      color: #ccc;
    }
    .download-btn {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 12px;
      background: #ff4747;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      font-size: 14px;
    }
    .download-btn:hover {
      background: #d93636;
    }
    footer {
      text-align: center;
      padding: 15px;
      background: #1e1e1e;
      font-size: 14px;
      color: #888;
    }
    audio {
      width: 100%;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <header>
    <h1>üéµ Reproductor YouTube MP3</h1>
    <p>Agrega enlaces de YouTube y crea tu propia playlist</p>
  </header>

  <section id="inputArea">
    <input type="text" id="ytUrl" placeholder="Pega un enlace de YouTube aqu√≠">
    <button onclick="downloadMedia()">‚ûï Agregar</button>
  </section>

  <main id="playlist"></main>

  <section style="padding:20px;">
    <audio id="audioPlayer" controls></audio>
  </section>

  <footer>
    <p>Hecho con ‚ù§Ô∏è <b>shadow.xyz</b></p>
  </footer>

  <script>
  const playlist = [];
  let currentIndex = 0; // √≠ndice de la canci√≥n actual

  async function downloadMedia(){
    const url=document.getElementById('ytUrl').value.trim();
    if(!url) return alert('Ingresa un enlace de YouTube');
    try{
      const apiUrl=`https://delirius-apiofc.vercel.app/download/ytmp3?url=${encodeURIComponent(url)}`;
      const res=await fetch(apiUrl); 
      const data=await res.json();
      if(!data.status) return alert('Error al obtener el media');
      
      const song={
        title:data.data.title, author:data.data.author,
        image:data.data.image_max_resolution||data.data.image,
        duration:data.data.duration, views:data.data.views, likes:data.data.likes,
        downloadUrl:data.data.download.url, filename:data.data.download.filename,
        type:data.data.download.extension
      };
      playlist.push(song); 
      renderPlaylist(); 
      document.getElementById('ytUrl').value='';

      // Si es la primera canci√≥n agregada ‚Üí reproducir autom√°ticamente
      if(playlist.length === 1) {
        playSong(0);
      }

    }catch(err){console.error(err); alert('Error en la descarga');}
  }

  function renderPlaylist(){
    const container=document.getElementById('playlist'); 
    container.innerHTML='';
    playlist.forEach((song,index)=>{
      const card=document.createElement('div'); 
      card.className='song-card';
      card.innerHTML=`
        <img src="${song.image}" alt="${song.title}">
        <div class="song-info">
          <h3>${song.title}</h3>
          <p>Autor: ${song.author}</p>
          <p>Duraci√≥n: ${Math.floor(song.duration/60)}:${('0'+(song.duration%60)).slice(-2)}</p>
          <p>Vistas: ${song.views} | Likes: ${song.likes}</p>
          <button onclick="playSong(${index})">‚ñ∂ Reproducir</button>
          <a class="download-btn" href="${song.downloadUrl}" download="${song.filename}" target="_blank">üíæ Descargar</a>
        </div>`;
      container.appendChild(card);
    });
  }

  function playSong(index){
    if(index<0 || index>=playlist.length) return;
    currentIndex = index;
    const audio=document.getElementById('audioPlayer');
    audio.src=playlist[index].downloadUrl;
    audio.play();

    // Mostrar cu√°l se est√° reproduciendo
    document.querySelectorAll('.song-card').forEach((card,i)=>{
      card.style.border = i===index ? "2px solid #1db954" : "2px solid transparent";
    });
  }

  // Evento: cuando termina una canci√≥n ‚Üí siguiente
  document.getElementById('audioPlayer').addEventListener('ended', ()=>{
    if(currentIndex < playlist.length-1){
      playSong(currentIndex+1);
    } else {
      console.log("üé∂ Playlist terminada");
    }
  });
  </script>
</body>
</html>